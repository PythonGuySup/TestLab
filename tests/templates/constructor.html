{% extends "base.html" %}

{% block page1 %}  {% endblock page1 %}
{% block page2 %}  {% endblock page2 %}

{% block content %}
    
<form method="POST">
    
    <label for="id_category">Категория:</label>
    <input type="text" name="category" maxlength="50" required id="id_category"></br>
    
    <label for="id_time">Время на тест:</label>
    <input type="text" name="time" required id="id_time"></br>
    
    <label for="id_title">Название теста:</label>
    <input type="text" name="title" maxlength="60" required id="id_title"></br>
    
    <label for="id_description">Описание:</label>
    <input type="text" name="description" maxlength="255" required id="id_description"></br>
    
    <label for="id_author">Автор:</label>
    <input type="text" name="author" required id="id_author"></br></br>
            
    <div class="padding-inside">
        <div id="questions_block" >
            <div id="question_1">
                <label for="id_question_1">Вопрос:</label>
                <input type="text" name="id_question_1" maxlength="255" required id="id_question_1"><button class="delete-question" data-question-id="1">Удалить вопрос...</button></br>
            
                <label for="id_multiple_ans_1">Несколько вариантов:</label>
                <input type="checkbox" name="multiple_ans_1" required id="id_multiple_ans_1"></br></br>

                <div class="padding-inside">
                    <div id="answers_block_1">
                        <div id="answer_1_1">
                            <label for="id_answer_1_1">Ответ:</label>
                            <input type="text" name="answer_1_1" maxlength="255" required id="id_answer_1_1"><button class="delete-answer" data-answer-id="1_1">Удалить ответ...</button></br>
                            
                            <label for="id_right_answer_1_1">Правильный ответ:</label>
                            <input type="checkbox" name="right_answer_1_1" required id="id_right_answer_1_1"></br>
                            </br>
                        </div>
                    </div>
                    <button class="add-answer" data-question-id="1">Добавить ответ...</button>
                </div>
                </br>  
            </div>
        </div>
        <button id="button_add_question" class="add-question">Добавить вопрос...</button>
    </div><style> .padding-inside {padding:20px;}</style></br></br>


    <input type="submit" value="Сохранить тест" >

    
</form>

<script>
    let questionCounter = 1;
    let answerCounter = 1;

    const addQuestionButton = document.querySelector('.add-question');
    addQuestionButton.addEventListener('click', () => {
        questionCounter++;
        const newQuestionBlock = `
            <div id="question_${questionCounter}">
                <label for="id_question_${questionCounter}">Вопрос:</label>
                <input type="text" name="id_question_${questionCounter}" maxlength="255" required id="id_question_${questionCounter}"><button class="delete-question" data-question-id="${questionCounter}">Удалить вопрос...</button></br>
            
                <label for="id_multiple_ans_${questionCounter}">Несколько вариантов:</label>
                <input type="checkbox" name="multiple_ans_${questionCounter}" required id="id_multiple_ans_${questionCounter}"></br></br>

                <div class="padding-inside">
                    <div id="answers_block_${questionCounter}">
                        <div id="answer_${questionCounter}_1">
                            <label for="id_answer_${questionCounter}_1">Ответ:</label>
                            <input type="text" name="answer_${questionCounter}_1" maxlength="255" required id="id_answer_${questionCounter}_1"><button class="delete-answer" data-answer-id="${questionCounter}_1">Удалить ответ...</button></br>
                            
                            <label for="id_right_answer_${questionCounter}_1">Правильный ответ:</label>
                            <input type="checkbox" name="right_answer_${questionCounter}_1" required id="id_right_answer_${questionCounter}_1"></br>
                            </br>
                        </div>
                    </div>
                    <button class="add-answer" data-question-id="${questionCounter}">Добавить ответ...</button>
                </div>
                </br>
            </div>
        `;
        const questionsBlock = document.getElementById('questions_block');
        questionsBlock.insertAdjacentHTML('beforeend', newQuestionBlock);

        // Добавляем обработчики событий для новых кнопок
        const deleteQuestionButtons = document.querySelectorAll('.delete-question');
        deleteQuestionButtons.forEach(button => {
            button.addEventListener('click', () => {
                const questionId = button.dataset.questionId;
                const questionBlock = document.getElementById(`question_${questionId}`);
                questionBlock.remove();
            });
        });

        const addAnswerButtons = document.querySelectorAll('.add-answer');
        addAnswerButtons.forEach(button => {
            button.addEventListener('click', () => {
                const questionId = button.dataset.questionId;
                answerCounter++;
                const newAnswerBlock = `
                    <div id="answer_${questionId}_${answerCounter}">
                        <label for="id_answer_${questionId}_${answerCounter}">Ответ:</label>
                        <input type="text" name="answer_${questionId}_${answerCounter}" maxlength="255" required id="id_answer_${questionId}_${answerCounter}"><button class="delete-answer" data-answer-id="${questionId}_${answerCounter}">Удалить ответ...</button></br>
                        
                        <label for="id_right_answer_${questionId}_${answerCounter}">Правильный ответ:</label>
                        <input type="checkbox" name="right_answer_${questionId}_${answerCounter}" required id="id_right_answer_${questionId}_${answerCounter}"></br>
                        </br>
                    </div>
                `;
                const answersBlock = document.getElementById(`answers_block_${questionId}`);
                answersBlock.insertAdjacentHTML('beforeend', newAnswerBlock);

                // Добавляем обработчик событий для новой кнопки удаления ответа
                const deleteAnswerButtons = document.querySelectorAll('.delete-answer');
                deleteAnswerButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const answerId = button.dataset.answerId;
                        const answerBlock = document.getElementById(`answer_${answerId}`);
                        answerBlock.remove();
                    });
                });
            });
        });
    });

    // Обработчики событий для кнопок удаления вопросов и ответов
    const deleteQuestionButtons = document.querySelectorAll('.delete-question');
    deleteQuestionButtons.forEach(button => {
        button.addEventListener('click', () => {
            const questionId = button.dataset.questionId;
            const questionBlock = document.getElementById(`question_${questionId}`);
            questionBlock.remove();
        });
    });

    const deleteAnswerButtons = document.querySelectorAll('.delete-answer');
    deleteAnswerButtons.forEach(button => {
        button.addEventListener('click', () => {
            const answerId = button.dataset.answerId;
            const answerBlock = document.getElementById(`answer_${answerId}`);
            answerBlock.remove();
        });
    });

    const addAnswerButtons = document.querySelectorAll('.add-answer');
    addAnswerButtons.forEach(button => {
        button.addEventListener('click', () => {
            const questionId = button.dataset.questionId;
            answerCounter++;
            const newAnswerBlock = `
                <div id="answer_${questionId}_${answerCounter}">
                    <label for="id_answer_${questionId}_${answerCounter}">Ответ:</label>
                    <input type="text" name="answer_${questionId}_${answerCounter}" maxlength="255" required id="id_answer_${questionId}_${answerCounter}"><button class="delete-answer" data-answer-id="${questionId}_${answerCounter}">Удалить ответ...</button></br>
                    
                    <label for="id_right_answer_${questionId}_${answerCounter}">Правильный ответ:</label>
                    <input type="checkbox" name="right_answer_${questionId}_${answerCounter}" required id="id_right_answer_${questionId}_${answerCounter}"></br>
                    </br>
                </div>
            `;
            const answersBlock = document.getElementById(`answers_block_${questionId}`);
            answersBlock.insertAdjacentHTML('beforeend', newAnswerBlock);

            // Добавляем обработчик событий для новой кнопки удаления ответа
            const deleteAnswerButtons = document.querySelectorAll('.delete-answer');
            deleteAnswerButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const answerId = button.dataset.answerId;
                    const answerBlock = document.getElementById(`answer_${answerId}`);
                    answerBlock.remove();
                });
            });
        });
    });
</script>
{% endblock content %}

